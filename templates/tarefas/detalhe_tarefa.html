{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhe da Tarefa {{ info_basica.protocolo }}{% endblock %}

{% block content %}
<div class="page-header mb-4">
    <h1 class="page-title">
        <i class="bi bi-file-earmark-text"></i>
        Tarefa: {{ info_basica.protocolo }}
    </h1>
    <p class="page-subtitle">{{ info_basica.servico }}</p>
</div>

<div class="row">
    <div class="col-lg-7">
        
        <div class="card-custom mb-4">
            <div class="card-header-custom" style="border-left: 5px solid {{ criticidade.cor }};">
                <h2 class="card-title-custom" style="color: {{ criticidade.cor }};">
                    {{ criticidade.emoji }} {{ criticidade.nivel|upper }}
                    <span class="text-muted" style="font-weight: 400; font-size: 1.2rem;">
                        - {{ criticidade.regra }}
                    </span>
                </h2>
                <p class="mb-0 fs-5">{{ criticidade.alerta }}</p>
                <small class="text-muted">Pontua√ß√£o de Ordena√ß√£o: {{ criticidade.pontuacao }}</small>
            </div>
        </div>

        <div class="card-custom">
            <div class="card-header-custom">
                <h2 class="card-title-custom">
                    <i class="fas fa-calculator"></i>
                    Detalhes do C√°lculo de Criticidade
                </h2>
            </div>
            <div class="card-body-custom">
                <h5>{{ regra_info.nome }}</h5>
                <p class="text-muted">{{ regra_info.descricao }}</p>
                
                <hr>
                
                <strong><i class="fas fa-check-square text-primary"></i> Condi√ß√µes Aplicadas:</strong>
                <ul class="list-unstyled ms-3 mt-2">
                    {% for condicao in regra_info.condicoes %}
                        <li><i class="fas fa-check text-success me-2"></i> {{ condicao }}</li>
                    {% empty %}
                        <li><i class="fas fa-info-circle text-muted me-2"></i> Nenhuma condi√ß√£o espec√≠fica.</li>
                    {% endfor %}
                </ul>
                
                <strong><i class="fas fa-cogs text-primary"></i> C√°lculo da Regra:</strong>
                <pre class="bg-light p-3 rounded mt-2"><code>{{ regra_info.calculo|default:"N/A" }}</code></pre>
                
                <strong><i class="fas fa-clipboard-list text-primary"></i> Classifica√ß√£o:</strong>
                <ul class="list-unstyled ms-3 mt-2">
                    {% for item in regra_info.classificacao %}
                        <li><i class="fas fa-chevron-right text-muted me-2"></i> {{ item }}</li>
                    {% empty %}
                         <li><i class="fas fa-chevron-right text-muted me-2"></i> NENHUMA</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="col-lg-5">
        
        <div class="card-custom mb-4">
            <div class="card-header-custom">
                <h5 class="card-title-custom mb-0">Informa√ß√µes da Tarefa</h5>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Status</small>
                    <strong>{{ info_basica.status }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Servidor</small>
                    <strong>{{ info_basica.servidor }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">SIAPE</small>
                    <strong>{{ info_basica.siape }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">GEX</small>
                    <strong>{{ info_basica.gex }}</strong>
                </li>
            </ul>
        </div>

        <div class="card-custom mb-4">
            <div class="card-header-custom">
                <h5 class="card-title-custom mb-0"><i class="fas fa-calendar-alt"></i> Datas Relevantes</h5>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Distribui√ß√£o</small>
                    <strong>{{ datas.distribuicao|date:"d/m/Y"|default:"-" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">√öltima Atualiza√ß√£o</small>
                    <strong>{{ datas.ultima_atualizacao|date:"d/m/Y"|default:"-" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Prazo</small>
                    <strong>{{ datas.prazo|date:"d/m/Y"|default:"-" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">In√≠cio Exig√™ncia</small>
                    <strong>{{ datas.inicio_exigencia|date:"d/m/Y"|default:"-" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Fim Exig√™ncia</small>
                    <strong>{{ datas.fim_exigencia|date:"d/m/Y"|default:"-" }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">√öltimo C√°lculo</small>
                    <strong>{{ datas.calculo_criticidade|date:"d/m/Y H:i"|default:"-" }}</strong>
                </li>
            </ul>
        </div>

        <div class="card-custom">
            <div class="card-header-custom">
                <h5 class="card-title-custom mb-0"><i class="fas fa-hourglass-half"></i> Tempos (em dias)</h5>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Dias em Pend√™ncia (Total)</small>
                    <span class="badge bg-secondary">{{ tempos.pendencia }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Dias com Servidor (L√≠quido)</small>
                    <span class="badge bg-info text-dark">{{ tempos.com_servidor }}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <small class="text-muted">Dias em Exig√™ncia (Total)</small>
                    <span class="badge bg-secondary">{{ tempos.exigencia }}</span>
                </li>
            </ul>
        </div>

    </div>
</div>

<div class="mt-4">
    <small class="text-muted">
        <strong>Legenda de Criticidade:</strong>
        <span class="badge bg-danger ms-2">üî¥ CR√çTICA - A√ß√£o imediata necess√°ria</span>
        <span class="badge bg-warning text-dark ms-2">üü† ALTA - Prazo excedido</span>
        <span class="badge" style="background-color: #ffc107; color: black;" class="ms-2">üü° M√âDIA - Pr√≥ximo do vencimento</span>
        <span class="badge bg-success ms-2">üü¢ BAIXA - Em observa√ß√£o</span>
        <span class="badge bg-secondary ms-2">‚ö™ NORMAL - Dentro do prazo</span>
    </small>
</div>

{% endblock %}